---
layout: post
title: Building a SD Card Temperature logger (ATMEGA328 + SDCARD + LM35)
date: '2013-03-11T19:53:00.001+05:30'
author: Anonymous
tags:
- Arduino PRO
- Temperature
- Interface
- Data logger
- Arduino
- ATMEGA328
- SD CARD
- ADC
- I/O
- LM35
modified_time: '2013-07-24T18:54:40.080+05:30'
thumbnail: http://lh6.ggpht.com/-gCiLHeHtdeU/UT3oy_BtjsI/AAAAAAAAAQw/4ziShwYwAPs/s72-c/DSCF5755_thumb%25255B2%25255D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-286864074933316179.post-2597483087678220780
blogger_orig_url: https://www.incrediblediy.com/2013/03/building-sd-card-temperature-logger.html
---

As we built an Arduino powered web server in <a href="http://www.incrediblediy.com/2013/03/arduino-based-webserver-atmega328.html" target="_blank">previous post,</a> let’s build a temperature logger using a SD card this time. I build this because I wanted to see how we can use a SD Card for our projects. The beauty of Arduino libraries are they have a FAT16/FAT32 library. So, we can use a large SD Card without any problem provided that the AVR you use has enough RAM &amp; programming memory. Here I’m using <a href="http://www.blogger.com/www.atmel.com/devices/atmega328.aspx" target="_blank">ATMEGA328</a> which has 2kB RAM and 32kB program memory.<br /><br /><u>SD Card module:</u><br /><br />Here I’m using a SD Card holding module I got a year back from <a href="http://www.ebay.com/itm/ws/eBayISAPI.dll?ViewItem&amp;item=330658250543&amp;ssPageName=ADME:L:OC:US:3160" target="_blank">ebay</a> for $1.6. You can even use a microsd card with a microSD to SD card adaptor. Just you have to solder some wires to the adaptor.SD Card pin out is available at <a href="http://pinouts.ru/Memory/sdcard_pinout.shtml" target="_blank">pinout.ru</a> site. SD Cards are also using SPI protocol for the communication.<br /><br /><u>Arduino Board:</u><br /><br />I’m using my Techduino Pro board which I build on an <a href="http://www.incrediblediy.com/2013/03/building-arduino-pro-arduino-uno-with.html">earlier post</a> along with the my <a href="http://www.incrediblediy.com/2013/03/modifying-cheap-cp2102-usb-to-uart.html">modified CP2102</a> USB to UART board. Please note that my Arduino is working at 3.3V.<br /><br /><u>LM35 Temperature Sensor:</u><br /><br />This is a typical analog temperature and you can find the datasheet from <a href="http://www.ti.com/lit/ds/symlink/lm35.pdf" target="_blank">here</a>. It has 10mV/Celsius linear scale factor and works at minimum of 4V for full range. According to the datasheet it can be used at less voltages but the measuring temperature range will be very low (check the Minimum Supply Voltage vs. Temperature curve).<br /><br /><u>Connections:</u><br /><br />I connected the two boards as follows to establish a SPI link between two,<br /><br /><table border="1" cellpadding="2" cellspacing="0" style="width: 400px;"><tbody><tr>       <td valign="top" width="200">SD Card Module</td>        <td valign="top" width="200">Arduino Pro</td>     </tr><tr>       <td valign="top" width="200">3.3V</td>        <td valign="top" width="200">3.3V</td>     </tr><tr>       <td valign="top" width="200">GND</td>        <td valign="top" width="200">GND</td>     </tr><tr>       <td valign="top" width="200">MOSI</td>        <td valign="top" width="200">Pin 11</td>     </tr><tr>       <td valign="top" width="200">MISO</td>        <td valign="top" width="200">Pin 12</td>     </tr><tr>       <td valign="top" width="200">SCK</td>        <td valign="top" width="200">Pin 13 </td>     </tr><tr>       <td valign="top" width="200">CS</td>        <td valign="top" width="200">Pin 10</td>     </tr></tbody></table><br /><br /><br /><a href="http://lh3.ggpht.com/-Ig2GnNpQlPw/UT3oxjt3NVI/AAAAAAAAAQo/z6dt7z6PMBU/s1600-h/DSCF5755%25255B5%25255D.jpg"><img alt="DSCF5755" border="0" height="384" src="http://lh6.ggpht.com/-gCiLHeHtdeU/UT3oy_BtjsI/AAAAAAAAAQw/4ziShwYwAPs/DSCF5755_thumb%25255B2%25255D.jpg?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5755" width="497" /></a><br /><a href="http://lh6.ggpht.com/-fESR8-uA8Ek/UT3o0qgqSqI/AAAAAAAAAQ4/4cs-4jGMfKw/s1600-h/DSCF5751%25255B5%25255D.jpg"><img alt="DSCF5751" border="0" height="353" src="http://lh4.ggpht.com/-4cHCORoHdC0/UT3o1jlERoI/AAAAAAAAARA/x9yWir2Bzlk/DSCF5751_thumb%25255B2%25255D.jpg?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5751" width="491" /></a><br /><br />I connected LM35 to the Arduino to get temperature. I connected LM35’s Vout pin to Arduino’s analog input 1 (A0). I also gave power supply by connecting +5V and GND to LM35. I powered up this using the USB power itself and so common ground maintained between Arduino and LM35.<br /><br /><a href="http://lh6.ggpht.com/-OFa7X5n6hCw/UT3o3AJo-eI/AAAAAAAAARI/GYTtMsOrI4I/s1600-h/DSCF5752%25255B3%25255D.jpg"><img alt="DSCF5752" border="0" height="244" src="http://lh5.ggpht.com/-qtpOowSnThk/UT3o34wsk4I/AAAAAAAAARQ/T3hg_6uYlVw/DSCF5752_thumb.jpg?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5752" width="217" /></a><br /><br /><u>Code:</u><br /><br />I’m here going to use ATMEGA328’s built in 10bit ADC with the Vref=3.3V(Vcc of the uC). You can learn accessing ADC on Arduino by reading <a href="http://playground.arduino.cc/CourseWare/AnalogInput" target="_blank">this article</a>. The SD card is accessed using the built in SD card library on Arduino. You can learn more about that using <a href="http://arduino.cc/en/Tutorial/ReadWrite" target="_blank">this link</a>. As I previously mentioned, LM35 has has 10mV/Celsius linear scale factor. So we have to do a little calculation to obtain the temperature. Here I’m using the full scale ADC method to get the ADC voltage.<br /><a href="http://lh3.ggpht.com/-RWi4B5LoOlA/UT3o4aTUn_I/AAAAAAAAARY/6XkGg760064/s1600-h/clip_image002%25255B4%25255D%25255B7%25255D.png"><br /></a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-PhUZKEzv_7M/UT3qYdiWjAI/AAAAAAAAAoQ/C9U8g-YA07g/s1600/eqn.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="126" src="http://3.bp.blogspot.com/-PhUZKEzv_7M/UT3qYdiWjAI/AAAAAAAAAoQ/C9U8g-YA07g/s320/eqn.jpg" width="320" /></a></div><a href="http://lh4.ggpht.com/-idRWarinjg0/UT3o5k5wTKI/AAAAAAAAARo/e5yh8el0cDc/s1600-h/clip_image002%25255B6%25255D%25255B3%25255D.png"><br /></a>So we get total factor as 0.32258 and we have to multiply is by ADC reading to get the temperature value.Here is the final code for the whole thing,<br /><br /><table border="1" cellpadding="2" cellspacing="0" style="width: 400px;"><tbody><tr>       <td valign="top" width="400">#include &lt;SPI.h&gt; <br />#include &lt;SD.h&gt;<br />File myFile;           <br />int x=0;            <br />int tempValue;<br />void setup()           <br />{            <br />pinMode(10, OUTPUT);            <br />SD.begin(10);            <br />}<br />void loop()           <br />{            <br />&nbsp; tempValue=analogRead(A0);            <br />myFile = SD.open("temp.txt", FILE_WRITE);            <br />if (myFile) {            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myFile.print("Temperature ");            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myFile.print(x);            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myFile.print(":");            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myFile.println((long)tempValue*0.32258);            <br />}            <br />&nbsp;&nbsp;&nbsp; myFile.close();            <br />&nbsp;&nbsp;&nbsp; x++;            <br />&nbsp;&nbsp;&nbsp; delay(1000);            <br />&nbsp; }&nbsp; </td>     </tr></tbody></table><br /><u>Testing:</u><br /><br />I hooked up everything and uploaded the compiled code. The SD card was inserted too. Then I checked the results by reading the SD Card using computer after some time. The results were impressive.<br /><br /><a href="http://lh3.ggpht.com/-Qms5jRvQ0Ms/UT3o7R68qjI/AAAAAAAAAR4/qtXnxCZ4U2M/s1600-h/TempLog%25255B3%25255D.jpg"><img alt="TempLog" border="0" height="484" src="http://lh6.ggpht.com/-1sNWqIE9yoc/UT3o8Xz3rsI/AAAAAAAAASA/HuLGP-fk3j4/TempLog_thumb%25255B1%25255D.jpg?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="TempLog" width="426" /></a>