---
layout: post
title: 'Introduction to MIPS CPU architecture with AR7240 '
date: '2013-04-15T21:40:00.000+05:30'
author: බුද්ධික
tags:
- Linux
- AR7240
- MIPS
- GPIO
- LED
- OpenWRT
- TL-WR740N
modified_time: '2013-04-15T21:44:57.656+05:30'
thumbnail: http://3.bp.blogspot.com/-PFWM7P3P-5M/UWwfRsrWOdI/AAAAAAAAApc/j0E6MVSqzFA/s72-c/router.png
blogger_id: tag:blogger.com,1999:blog-286864074933316179.post-4356039518964575476
blogger_orig_url: https://www.incrediblediy.com/2013/04/introduction-to-mips-cpu-architecture.html
---

<div style="text-align: justify;">There are many CPU architectures in current embedded devices. <a href="http://en.wikipedia.org/wiki/MIPS_architecture">MIPS</a> is also a popular architecture for embedded systems. Here I'm going to play with a MIPS based&nbsp;&nbsp;<a href="http://wiki.openwrt.org/_media/toh/tp-link/atheros.ar7240.pdf">AR7240</a> SoC as my development environment which has a&nbsp;<a href="http://www.mips.com/products/processor-cores/mips32-24k/">MIPS 24Kc CPU</a>&nbsp;. I'm using a<a href="http://www.tp-link.dk/products/details/?model=TL-WR740N"> TPLINK-WR740N</a> router as my development board as I don't have any other MIPS development boards. It runs <a href="https://openwrt.org/">OpenWRT</a> Linux for MIPS (this is not the stock version,I have installed it). So I won't be going to much lower level and I will play at the Linux level like using Linux on <a href="http://www.raspberrypi.org/">Rarspberry PI</a>.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><u>Router specifications:</u></div><ul><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">Atheros AR7240@400MHz RAM:32MB Flash:4MB</span></li><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">LED * 5</span></li><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">Push buttons * 2</span></li></ul><div style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;"><u>AR7240 has following interfaces:</u></span></div><ul><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">LAN * 5</span></li><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">WiFi * 1</span></li><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">UART</span></li><li style="text-align: justify;"><span style="font-family: sans-serif; font-size: 14px; line-height: 21.58333396911621px;">USB</span></li><li style="text-align: justify;">GPIO (LEDs &amp; Push buttons are already connected)</li></ul><div style="text-align: justify;">For testing I just wanted to blink a LED which is connected to the GPIO0 using a shell script.</div><div style="text-align: justify;">I found the GPIO mappings from the OpenWRT <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd">wiki</a>. The LEDs are already controlled by a module by default and I had to unload it using "<b>rmmod leds_gpio</b>" command. If you are new to Linux, <a href="http://www.serverschool.com/server-configuration/kernel-modules/">here </a>you can find about Linux kernal modules. I found a <a href="https://sites.google.com/site/bifferboard/Home/gpio">great tutorial</a> on controlling GPIOs in any Linux system and I coded a simple shell script to blink the LED connected to GPIO0 in 1 second intervals.&nbsp;Raspberry&nbsp;PI wiki also has a good&nbsp;<a href="http://elinux.org/RPi_Low-level_peripherals">tutorial </a>on this.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Code:</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><i><b>rmmod leds_gpio</b></i></div><div style="text-align: justify;"><i><b>echo 0 &gt; /sys/class/gpio/export</b></i></div><div style="text-align: justify;"><i><b>echo out &gt; /sys/class/gpio/gpio0/direction</b></i></div><div style="text-align: justify;"><i><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</b></i></div><div style="text-align: justify;"><i><b>while [ 0 != 1 ] &nbsp;</b></i></div><div style="text-align: justify;"><i><b>do</b></i></div><div style="text-align: justify;"><i><b>&nbsp; echo "ON"</b></i></div><div style="text-align: justify;"><i><b>&nbsp; echo 1 &gt; /sys/class/gpio/gpio0/value</b></i></div><div style="text-align: justify;"><i><b>&nbsp; sleep 1</b></i></div><div style="text-align: justify;"><i><b>&nbsp; echo "OFF"</b></i></div><div style="text-align: justify;"><i><b>&nbsp; echo 0 &gt; /sys/class/gpio/gpio0/value</b></i></div><div style="text-align: justify;"><i><b>&nbsp; sleep 1</b></i></div><div style="text-align: justify;"><i><b>done &nbsp;</b></i></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">I logged into the router with "<b>ssh 10.0.0.1 -l root</b>" and made a shell script called <b>blinky.sh </b>with above code using echo command (<b>echo "</b><i>the above code</i><b>" &gt; blinky.sh</b>). You can create the blinky.sh file on PC and upload it to router using a SFTP client too. Then I made it executable with "<b>chmod +x blinky.sh</b>". Finally I run the script using "<b>./blinky.sh</b>" and it was a success.</div><div style="text-align: justify;">(In below photo, the error is because I already unloaded the leds_gpio module)</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-PFWM7P3P-5M/UWwfRsrWOdI/AAAAAAAAApc/j0E6MVSqzFA/s1600/router.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em; text-align: justify;"><img border="0" height="640" src="http://3.bp.blogspot.com/-PFWM7P3P-5M/UWwfRsrWOdI/AAAAAAAAApc/j0E6MVSqzFA/s640/router.png" width="571" /></a></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;"><object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="http://i.ytimg.com/vi/6GHczx-SwgA/0.jpg" height="266" width="320"><param name="movie" value="http://www.youtube.com/v/6GHczx-SwgA?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="http://www.youtube.com/v/6GHczx-SwgA?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div><div style="text-align: justify;"><br /></div>