---

title: Arduino based Webserver (ATMEGA328 + ENC28j60)
date: '2013-03-09T23:32:00.001+05:30'

tags:
- TechDuino
- Arduino PRO
- Ethernet
- Networking
- Arduino
- ATMEGA328
- SPI
- Wireshark
- ENC28J60
modified_time: '2017-01-09T19:13:51.575+05:30'
thumbnail: http://lh3.ggpht.com/-acDDSQYAqco/UTt5DWYq_DI/AAAAAAAAAPA/POY-xfNDqjY/s72-c/DSCF5688_640x480_thumb%25255B1%25255D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-286864074933316179.post-3182946898685250821
blogger_orig_url: https://www.incrediblediy.com/2013/03/arduino-based-webserver-atmega328.html
---

<b>Updated on 09-01-2017 to correct issue with MAC address: (Identifed by Julien as per in the comment section)</b><br /><br /><b>Replaced : static byte mymac[] = {0xDD,0xDD,0xDD,0x00,0x00,0x01}; with new value.</b><br /><br />As I built a Arduino Pro clone based development board running with 3.3V, I thought to give it a try with my Ethernet module for testing. This is an example for 3.3V LVTTL system. If you use this ENC28J60 on a 5V system,you may have to use logic level convertors.<br /><u>Ethernet module:</u><br />Based on <a href="http://www.google.lk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CDAQFjAA&amp;url=http%3A%2F%2Fwww.microchip.com%2Fwwwproducts%2FDevices.aspx%3FdDocName%3Den022889&amp;ei=fnI7Ud6BKsLlrAfar4DYCA&amp;usg=AFQjCNEgpf0NnUmz0LSWKwIJ6Xkvg8lG-Q&amp;sig2=X90c9ckfbAest4DAhLbzHw&amp;bvm=bv.43287494,d.bmk" target="_blank">Microchip’s ENC28J60</a> chip. I’m using a board made by Sure electronics (really good manufacture) called <a href="http://www.sureelectronics.net/goods.php?id=1180" target="_blank">MB-CM14111</a>. I got this 2 years back from ebay for $10. You can now find cheap boards on ebay and do an <a href="http://www.ebay.com/sch/i.html?_from=R40&amp;_sacat=0&amp;_nkw=enc28j60&amp;_sop=15" target="_blank">ebay search as “enc28j60”</a>. ENC28J60 is a SPI device and needed to be connected to ATMEGA328’s SPI module.<br /><u>Arduino Board:</u><br />I’m using my Techduino Pro board which I build on an <a href="http://www.incrediblediy.com/2013/03/building-arduino-pro-arduino-uno-with.html" target="_blank">earlier post</a> along with the my <a href="http://www.incrediblediy.com/2013/03/modifying-cheap-cp2102-usb-to-uart.html" target="_blank">modified CP2102</a> USB to UART board.<br /><u>Connections:</u><br />I connected the two boards as follows to establish a SPI link between two;<br /><table border="1" cellpadding="2" cellspacing="0" style="width: 400px;"><tbody><tr>       <td valign="top" width="200">Ethernet Module</td>        <td valign="top" width="200">Techduino</td>     </tr><tr>       <td valign="top" width="200">3.3V</td>        <td valign="top" width="200">3.3V</td>     </tr><tr>       <td valign="top" width="200">GND</td>        <td valign="top" width="200">GND</td>     </tr><tr>       <td valign="top" width="200">DI</td>        <td valign="top" width="200">Pin 11</td>     </tr><tr>       <td valign="top" width="200">DO</td>        <td valign="top" width="200">Pin 12</td>     </tr><tr>       <td valign="top" width="200">CLK</td>        <td valign="top" width="200">Pin 13</td>     </tr><tr>       <td valign="top" width="200">CS</td>        <td valign="top" width="200">Pin 10</td>     </tr></tbody></table><a href="http://lh5.ggpht.com/-Yh_I3133WlI/UTt5CcJMFAI/AAAAAAAAAO4/eP4b-P7Wyeo/s1600-h/DSCF5688_640x480%25255B4%25255D.jpg"><img alt="DSCF5688_640x480" border="0" src="http://lh3.ggpht.com/-acDDSQYAqco/UTt5DWYq_DI/AAAAAAAAAPA/POY-xfNDqjY/DSCF5688_640x480_thumb%25255B1%25255D.jpg?imgmax=800" height="484" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5688_640x480" width="364" /></a><br /><a href="http://lh5.ggpht.com/-fMH_ZE9wrdw/UTt5EY5wc4I/AAAAAAAAAPI/_f6ToUDKkwI/s1600-h/DSCF5693_480x640%25255B5%25255D.jpg"><img alt="DSCF5693_480x640" border="0" src="http://lh4.ggpht.com/-zvj82lo9kSQ/UTt5FdWTjYI/AAAAAAAAAPQ/tgszfxDwE-U/DSCF5693_480x640_thumb%25255B2%25255D.jpg?imgmax=800" height="385" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5693_480x640" width="502" /></a><br /><a href="http://lh5.ggpht.com/-4ycXpKmQNnc/UTt5GRTEZyI/AAAAAAAAAPY/tqe88Ytyg6s/s1600-h/DSCF5697_640x480%25255B4%25255D.jpg"><img alt="DSCF5697_640x480" border="0" src="http://lh3.ggpht.com/-dYJZZR-zd9U/UTt5HYzOOiI/AAAAAAAAAPg/raUkV2eXTL8/DSCF5697_640x480_thumb%25255B1%25255D.jpg?imgmax=800" height="484" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="DSCF5697_640x480" width="364" /></a><br /><u>Software Library:</u><br />I used EtherCard Arduino library from JCW’s GIT repository. See <a href="https://github.com/jcw/ethercard/blob/master/README.md" target="_blank">here</a> for downloads and installation instructions. You just have to download the zip file and extract it to your Arduino’s library folder(in my case arduino-1.0.3\libraries) and rename it to EtherCard.<br /><u>Code:</u><br />I used a very basic code just to serve a static page from the webserver. You can find many more detailed information on using this library from <a href="http://www.lucadentella.it/en/category/enc28j60-arduino/" target="_blank">LUCA’s ENC28J60 tutorials</a>.This is the code I used. You just have to copy this code to Arduino IDE and compile it and upload.Modify myip[] ass you wish.This is the device’s IP address.The library also supports DHCP but here I’m using a static IP for the simplicity.I also omitted the standard HTTP requests/replies on this code for the simplicity.<br /><table border="1" cellpadding="2" cellspacing="0" style="width: 400px;"><tbody><tr>       <td valign="top" width="400">#include &lt;EtherCard.h&gt;<br /><b>static byte mymac[] = {0xDE,0xDD,0xDD,0x00,0x00,0x01};</b><br />static byte myip[] = {192,168,1,10};            <br />byte Ethernet::buffer[700];            <br />&nbsp; <br />void setup () {            <br />&nbsp; ether.begin(sizeof Ethernet::buffer, mymac,10);            <br />&nbsp; ether.staticSetup(myip);            <br />}            <br />&nbsp; <br />void loop() {            <br />&nbsp; <br />&nbsp; word len = ether.packetReceive();            <br />&nbsp; word pos = ether.packetLoop(len);            <br />&nbsp; <br />&nbsp; if(pos) {&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; BufferFiller bfill = ether.tcpOffset();            <br />&nbsp;&nbsp;&nbsp; bfill.emit_p(PSTR("&lt;h1&gt;hello&lt;/h1&gt;"));            <br />&nbsp;&nbsp;&nbsp; ether.httpServerReply(bfill.position());            <br />&nbsp; }            <br />}            </td>     </tr></tbody></table><u>Testing:</u><br />I connected the Ethernet module to my gigabit Ethernet card using a straight cable (my card auto detects straight or crossover connection).I set my PC’s address to be 192.168.1.1 manually. Then I tried a ping test to the Ethernet module by&nbsp; “ping 192.168.1.10” on command prompt. It was a success in first round.<br /><a href="http://lh6.ggpht.com/-w5YFQnnAxBo/UTt5IZw5f5I/AAAAAAAAAPo/Y-80gBioh-s/s1600-h/Ping%25255B3%25255D.jpg"><img alt="Ping" border="0" src="http://lh3.ggpht.com/-1hbiP6s7ibQ/UTt5JGOjy3I/AAAAAAAAAPw/aJ2-UkCUGIA/Ping_thumb%25255B1%25255D.jpg?imgmax=800" height="327" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Ping" width="644" /></a><br />Then I opened my browser and visited <a href="http://192.168.1.10/">http://192.168.1.10</a> , TaDa!!!! The web page is working <img alt="Open-mouthed smile" class="wlEmoticon wlEmoticon-openmouthedsmile" src="http://lh5.ggpht.com/-VksvFXiAXTo/UTt5J7Z-xtI/AAAAAAAAAP4/Zoajpm9Qlow/wlEmoticon-openmouthedsmile%25255B2%25255D.png?imgmax=800" style="border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none;" /><br /><a href="http://lh6.ggpht.com/-3iIYXDuf9L4/UTt5K86bQ1I/AAAAAAAAAQA/yjWpi8w6Vzg/s1600-h/Web%25255B3%25255D.jpg"><img alt="Web" border="0" src="http://lh4.ggpht.com/-BGHvMLWhHV8/UTt5L5Q9BtI/AAAAAAAAAQI/4XnOLw7cwX0/Web_thumb%25255B1%25255D.jpg?imgmax=800" height="473" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Web" width="644" /></a><br />I did a simple packet tracking using <a href="http://www.wireshark.org/download.html" target="_blank">WireShark</a> too. Just to see what’s happening there. You can see how&nbsp; the ping requests and replies going through the network.<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><a href="http://lh6.ggpht.com/-YcyHcTgJBk4/UTt5NhLUmOI/AAAAAAAAAQQ/8-9hBS-rW3o/s1600-h/Wireshark%25255B3%25255D.jpg"><img alt="Wireshark" border="0" src="http://lh5.ggpht.com/-0VWzOURk4b4/UTt5O2HKmSI/AAAAAAAAAQY/cHXbdVF1B34/Wireshark_thumb%25255B1%25255D.jpg?imgmax=800" height="375" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Wireshark" width="644" />&nbsp;</a><br /><br /><br /><br />